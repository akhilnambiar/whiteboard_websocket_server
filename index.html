
<html>
  <head>
    <style>
      body {
        font-family: "Helvetica Neue", helvetica, arial;
        padding: 15px;
      }

      ul {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      ul li {
        line-height: 1.4;
      }
    </style>

    <script>
      function encode (input) {
          var keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
          var output = "";
          var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
          var i = 0;

          while (i < input.length) {
              chr1 = input[i++];
              chr2 = i < input.length ? input[i++] : Number.NaN; // Not sure if the index 
              chr3 = i < input.length ? input[i++] : Number.NaN; // checks are needed here

              enc1 = chr1 >> 2;
              enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
              enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
              enc4 = chr3 & 63;

              if (isNaN(chr2)) {
                  enc3 = enc4 = 64;
              } else if (isNaN(chr3)) {
                  enc4 = 64;
              }
              output += keyStr.charAt(enc1) + keyStr.charAt(enc2) +
                        keyStr.charAt(enc3) + keyStr.charAt(enc4);
          }
          return output;
      }
      var host = location.origin.replace(/^http/, 'ws')
      var ws = new WebSocket(host);
      ws.onmessage = function (event) {
        console.log("YEA");
        console.log(event.data.type);
        console.log(event.data.size)
        var li = document.createElement('li');
        //li.innerHTML = JSON.parse(event.data);
        li.innerHTML = event.data
        //document.querySelector('#pings').appendChild(li);
        document.getElementById('warble-msg').innerHTML = event.data;



        
        
        
          /*
        function utf8Decode(bytes) {
          console.log("CALLED IT");
        var chars = [], offset = 0, length = bytes.length, c, c2, c3;

        while (offset < length) {
          c = bytes[offset];
          c2 = bytes[offset + 1];
          c3 = bytes[offset + 2];

          if (128 > c) {
            chars.push(String.fromCharCode(c));
            offset += 1;
          } else if (191 < c && c < 224) {
            chars.push(String.fromCharCode(((c & 31) << 6) | (c2 & 63)));
            offset += 2;
          } else {
            chars.push(String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63)));
            offset += 3;
          }
        }
        
        return chars.join('');
        }
        */

        var decoded = utf8Decode(event.data);

        
        var reader = new window.FileReader();
        reader.readAsText(event.data); 
        reader.onloadend = function() {
          base64data = reader.result;                
          console.log(base64data );
        }


        var image = new Image();
        //var a = base64data.replace(/data:/g,"data:image/png");
        console.log(base64data);
        image.src = base64data;
        document.body.appendChild(image);


        //TRYING SOME STUFF OUT
        var arrayBuffer = event.data;
        var bytes = new Uint8Array(arrayBuffer);
        var image = document.getElementById('image');
        image.src = encode(bytes);

      };
    </script>
  </head>
  <body>
    <h1>Pings</h1>
    <ul id='pings'></ul>
    <h3 id="warble-msg"></h3>
    <img id="image"></img>
  </body>
</html>
<!--
OLD VERSION WITH WS

<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Warble Warble!</title>
  <link rel="stylesheet" type="text/css" href="style.css"></link> 
</head>
<body>
  <img src="http://blog.birdbox.com/wp-content/uploads/2012/09/logoH21.png" alt="Birdbox"></img>
  <div class="status">
    <h2>Status: <span class="connect-status disconnected">Disconnected</span></h2>
  </div>
  <h3 id="warble-msg"></h3>
  <form class="msg-sender">
    <input type="text" placeholder="Type something"></input>
  </form>

  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/sockjs-client/0.3.4/sockjs.min.js"></script>
  <script src="warble.js"></script>
</body>
</html>
-->